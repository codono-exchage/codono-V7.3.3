<!-- Home Market Start -->
<style>
 .current a {
    color: var(--theme-multiverse-color);
	font-weight: bolder;
 }

/* Apply this to each of the table columns as needed */
.fixed-width {
    min-width: 40px; /* Adjust width as per your content */
    max-width: 120px; /* Adjust this to prevent overflow */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
 
</style>
<section class=" pb-10 dark:bg-dark bg-white p-5 flex justify-center overflow-hidden">
  <div class="1300px:w-[1300px] lg:w-[1024px] md:w-[768px] sm:w-[640px]">
    <h1
      class="1300px:text-[2.5rem] lg:text-[2rem] sm:text-[1.5rem] text-[1.2rem] dark:text-white pl-5"
    >
      <span class="font-medium">Market </span> Trends
    </h1>
    <div
      class="w-full md:border dark:border-gray-50/20 md:p-3 mt-4 rounded-md divide-x dark:divide-gray-50/50"
    >
      <div class="h-full  lg:pr-10">
        <div
          class="pl-5 w-full overflow-auto border-b dark:border-b-gray-50/20 lg:p-2 lg:pl-10 border-navColor/50 md:flex justify-between items-center"
        >
          <div class="">
            <div class="space-x-4 flex w-0">
              <ul
                style="list-style-type: none"
                class="trade_qu_list nav nav-pills trade_qu_list space-x-4 flex w-0"
                role="tablist">
                <volist name="codono_jiaoyiqu" id="v">
                  <li class="nav-link trade_moshi trade_qu_pai whitespace-nowrap lg:text-xl text-subTitleColor dark:text-white sm:text-md text-sm font-medium leading-[3] " data="{$key}" onclick="trade_qu(this)">
                    <a href="#highlighted-justified-tab1" class="<if condition='$v eq 0'>active</if>" data-toggle="tab">{$v}</a>
                  </li>
                </volist>
              </ul>
            </div>
          </div>
        </div>
        <div class="lg:px-10 pb-5 md:py-0 py-5  overflow-auto"> 
         <table class="table coin-list md:table dark:text-white text-xs" style="width: 100%">
            <thead class="price_today_ull">
              <tr class="">
                <th
                  data-sort="0"
                  style="cursor: default"
                  class="p-5 text-left font-medium lg:text-xl fixed-width ">
                  {:l('PAIR')}
                </th>
                <th
                  scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl fixed-width "
                  data-sort="1"
                  data-flaglist="0"
                  data-toggle="0">
                  {:l('PRICE')}
                </th>
               <th
                  scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl hidden md:table-cell fixed-width "
                  data-sort="2"
                  data-flaglist="0"
                  data-toggle="0"
                >
                  {:l('Buy')}
                </th>
                <th
                  scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl hidden md:table-cell fixed-width "
                  data-sort="3"
                  data-flaglist="0"
                  data-toggle="0"
                >
                  {:l('Sell')}
                </th>
                
                <th scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl fixed-width "
                  data-sort="6"
                  data-flaglist="0"
                  data-toggle="0"
                >
                  24H {:l('vol')}
		</th> 
                
                <th
                  scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl whitespace-nowrap hidden md:table-cell fixed-width "
                  data-sort="4"
                  data-flaglist="0"
                  data-toggle="0"
                >
                  24H {:l('Total')}
                </th>
                <th
                  scope="col"
                  class="click-sort p-5 text-left font-medium lg:text-xl fixed-width "
                  data-sort="7"
                  data-flaglist="0"
                  data-toggle="0"
                >
                  {:l('CHANGE')}
                </th>
                <th class="p-5 text-left font-medium lg:text-xl hidden md:table-cell fixed-width ">{:l('Trade')}</th>
              </tr>
            </thead>

            <tbody id="price_today_ul"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>


	<script>
	$('.price_today_ull > .click-sort').each(function () {
		$(this).click(function () {
			click_sortList(this);
		})
	});
	function allcoin_callback(priceTmp) {
		for (var i in priceTmp) {
			var c = priceTmp[i][8];
			if (typeof (trends[c]['data']) && typeof (trends[c]['data']) != 'null') {
				if (typeof (trends[c]) != 'undefined' && typeof (trends[c]['data']) != 'undefined') {
				
				}
			}
		}
	}
	function click_sortList(sortdata) {
		var a = $(sortdata).attr('data-toggle');
		var b = $(sortdata).attr('data-sort');
		$(".price_today_ull > th").find('.fa-angle-up').css('border-bottom-color', '#848484');
		$(".price_today_ull > th").find('.fa-angle-down').css('border-top-color', '#848484');
		$(".price_today_ull > th").attr('data-flaglist', 0).attr('data-toggle', 0);
		$(".price_today_ull > th").css('color', '');
		$(sortdata).css('color', '#1a81d6');
		if (a == 0) {
			priceTmp = priceTmp.sort(sortcoinList('dec', b));
			$(sortdata).find('.fa-angle-down').css('border-top-color', '#1a81d6');
			$(sortdata).find('.fa-angle-up').css('border-bottom-color', '#848484');
			$(sortdata).attr('data-flaglist', 1).attr('data-toggle', 1)
		}
		else if (a == 1) {
			$(sortdata).attr('data-toggle', 0).attr('data-flaglist', 2);
			$(sortdata).find('.fa-angle-up').css('border-bottom-color', '#1a81d6');
			$(sortdata).find('.fa-angle-down').css('border-top-color', '#848484');
			priceTmp = priceTmp.sort(sortcoinList('asc', b));
		}
		renderPage(priceTmp);
		change_line_bg('price_today_ul', 'li');
	//	allcoin_callback(priceTmp);
	}
	function trends() {
		$.getJSON("{:U('Ajax/top_coin_menu')}?t=" + rd(), function (d) {
			trends = d;
			allcoin();
		});
	}
	function allcoin(cb) {
		var trade_qu_id = $('.trade_qu_list .current').attr('data');
		$.get("{:U('Ajax/allcoin_a')}/id/" + trade_qu_id + '?t=' + rd(), cb ? cb : function (data) {
	//		console.log(97,data);
			var d;
			if (data.status == 1) {
				d = data.url;
			}
			ALLCOIN  = d;
			var t    = 0;
			var img  = '';
			priceTmp = [];
			for (var x in d) {
				if (typeof(trends[x]) != 'undefined' && parseFloat(trends[x]['yprice']) > 0) {
					rise1 = (((parseFloat(d[x][4]) + parseFloat(d[x][5])) / 2 - parseFloat(trends[x]['yprice'])) * 100) / parseFloat(trends[x]['yprice']);
					rise1 = rise1.toFixed(2);
				} else {
					rise1 = 0;
				}
				img = d[x].pop();
				d[x].push(rise1);
				d[x].push(x);
				d[x].push(img);
				priceTmp.push(d[x]);
			}
			$('.price_today_ull > .click-sort').each(function () {
				var listId = $(this).attr('data-sort');
				if ($(this).attr('data-flaglist') == 1 && $(this).attr('data-sort') !== 0) {
					priceTmp = priceTmp.sort(sortcoinList('dec', listId))
				} else if ($(this).attr('data-flaglist') == 2 && $(this).attr('data-sort') !== 0) {
					priceTmp = priceTmp.sort(sortcoinList('asc', listId))
				}
			});
			renderPage(priceTmp);
		//	allcoin_callback(priceTmp);
			change_line_bg('price_today_ul', 'li');
			//t = setTimeout('allcoin()', 5000);
		}, 'json');
	}
	function rd() {
		return Math.random()
	}
	var socket_array=[];

	
	function renderPage(ary) {
    var html = '';
    for (var i in ary) {
        var coinfinance = 0;
        if (typeof FINANCE == 'object') coinfinance = parseFloat(FINANCE.data[ary[i][8] + '_balance']);
        let total_24 = ary[i][4] * ary[i][6];

        html += '<tr id="m_' + ary[i][15] + '" style="margin-bottom: .5rem; font-size: 17px" class="font-medium">'
            + '<td class="pl-5 p-5 whitespace-nowrap"><a href="/trade/index/market/' + ary[i][8] + '/">' + ary[i][12] + '</a></td>'
            + '<td class="monospace-font tc-warning">' + formatCount(ary[i][1]) + '</td>'
            + '<td class="monospace-font whitespace-nowrap hidden md:table-cell">' + formatCount(total_24) + '</td>' // 24H Total
            + '<td class="monospace-font ' + (ary[i][7] >= 0 ? 'green' : 'red') + '">' + ary[i][6] + '</td>'
            + '<td class="monospace-font hidden md:table-cell">' + formatCount(ary[i][3]) + '</td>' // Buy
            + '<td class="monospace-font hidden md:table-cell">' + formatCount(total_24) + '</td>' // Sell
            + '<td class="monospace-font ' + (ary[i][7] >= 0 ? 'green' : 'red') + '">' + ((parseFloat(ary[i][7]) < 0.01 && parseFloat(ary[i][7]) > -0.01) ? "0.00" : (parseFloat(ary[i][7])).toFixed(2)) + '%</td>'
            + '<td class="text-right hidden md:table-cell"><a href="/trade/index/market/' + ary[i][8] + '/" class="btn-2 hover:text-dark duration-300">{:l(\'TO_TRADE\')}</a></td>'
            + '</tr>';

        socket_array[i] = ary[i][15];
    }
	//console.log(226,html);
    $('#price_today_ul').html(html);
}

function formatCount(count) {
	//console.log(231,count)	;
    // Convert to a number and handle non-numeric values
    if (isNaN(count) || count === null || count === undefined) {
		
        return count; // or any other placeholder for invalid numbers
    }

    // Parse count as a float with a maximum precision of 8 decimal places
    count = parseFloat(parseFloat(count).toFixed(8));

    // Constants to represent the numerical thresholds
    const BILLION = 1e9;
    const MILLION = 1e6;

    // Helper function to format the number with 2 decimal places and a suffix
    function formatWithSuffix(value, suffix) {
        return value.toFixed(2) + ' ' + suffix;
    }

    // Return formatted output based on the numerical value
    if (count >= BILLION) {
        return formatWithSuffix(count / BILLION, 'bl');
    } else if (count >= MILLION) {
        return formatWithSuffix(count / MILLION, 'ml');
    } else {
        // Return the count directly with 2 decimal places for uniformity
        return count.toFixed(2);
    }
}


		/*function formatCount(num) {
	         return  (new Intl.NumberFormat("en-US", {
				  notation: "compact",
            compactDisplay: "long",
                 maximumFractionDigits: 2,
            style: "currency",
            currency:  "USD",
        }).format(num));
                 }*/
	function change_line_bg(id, tag, nobg) {
		var oCoin_list = $('#' + id);
		var oC_li      = oCoin_list.find(tag);
		var oInp       = oCoin_list.find('input');
		var oldCol     = null;
		var newCol     = null;
		if (!nobg) {
			for (var i = 0; i < oC_li.length; i++) {
				oC_li.eq(i).css('background-color', i % 2 ? '#f8f8f8' : '#fff');
			}
		}
		oCoin_list.find(tag).hover(function () {
			oldCol = $(this).css('backgroundColor');
			$(this).css('background-color', '#eaedf4');
		}, function () {
			$(this).css('background-color', oldCol);
		})
	}
	function sortcoinList(order, sortBy) {
		var ordAlpah = (order == 'asc') ? '>' : '<';
		var sortFun  = new Function('a', 'b', 'return parseFloat(a[' + sortBy + '])' + ordAlpah + 'parseFloat(b[' + sortBy + '])? 1:-1');
		return sortFun;
	}
	function trade_qu(o){
		$('.trade_qu_pai').removeClass('current');

		$('.trade_qu_pai').removeClass('dark:current');
		$(o).addClass('current');
		$(o).addClass('dark:current');
		allcoin();
	}
	trends()	
         document.querySelector(".trade_moshi").click()
</script>
