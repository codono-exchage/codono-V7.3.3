<include file="Public:header" />
<div class="">
  <main class="wrapper stake-page">
    <!-- Account Heading Start -->
    <div class="page-top-banner">
      <div
        class="filter"
        style="
          background-image: url('__EPSILON__/img/redesign/slider/filter2-min.png');
        "
      >
        <div class="container">
          <div class="row">
            <div class="col-12 col-md-8 mt-3">
              <h1>{:l('My Machines')}</h1>
              <h2>{$prompt_text}</h2>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Account Heading End -->
    <div class="container launchpad-page">
      <div class="row mt-3 mb-3 ">
        <include file="User:top_bar" />
        <div class="col-12 col-md-6 order-1 order-md-2 float-right">
          <ul class="text-right breadcrumbs list-unstyle">
            <li>
              <a href="{:U('/pool')}" class="btn btn-warning btn-sm"
                >{:l('Pool Home')}</a
              >
            </li>
            <li class="btn btn-warning btn-sm active">{:l('My Machines')}</li>
            <li>
              <a href="{:U('/pool/myRewards')}" class="btn btn-warning btn-sm"
                >{:l('My Rewards')}</a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="stake-table table-responsive card">
        <div class="card-body">
        <table class="table table-condensed table-sm" id="my_machines">
          <thead>
            <tr>
              <th id="sublist-grid_c0">{:L('Name')}</th>
              <th id="sublist-grid_c1">{:L('Time')}</th>
              <th id="sublist-grid_c2">{:L('Price')}</th>
              
              <th id="sublist-grid_c4">{:L('Daily Reward')}</th>
              <th id="sublist-grid_c5">{:L('Days Used')}</th>
              <th id="sublist-grid_c6">{:L('Power')}</th>
              <th id="sublist-grid_c7">{:L('Time')}</th>
              <th id="sublist-grid_c8">{:L('Status')}</th>
              <th id="sublist-grid_c9">{:L('Action')}</th>
            </tr>
          </thead>
          <tbody>
            <volist name="list" id="vo">
              <tr>
                <td><strong>{$vo['name']}</strong></td>
                <td>{$vo['days']} {:L('Days')}</td>
                <td>{$vo['price']*1} {$vo['coinname']}</td>
                
                <td>{$vo['daily_profit']*1} {$vo['getcoin']}</td>
                <td>{$vo['collected']}/{$vo['days']}</td>
                <td>{$vo['power']}</td>
                <td>{$vo['addtime']|addtime}</td>
                <td>
                  <switch name="vo.status">
                    <case value="0">{:l('Ready state')}</case>
                    <case value="1">{:l('Mining Currently')}</case>
                    <case value="2">{:l('Mining Completed')}</case>
                  </switch>
                  <include file="Pool:buyform" />
                </td>
                <td>
                  <switch name="vo.status">
                    <case value="0"
                      ><span
                        onclick="startpool('{$vo['id']}')"
                        class="btn btn-sm btn-info btn-block"
                        ><i class="fa fa-play"></i> {:l('Start Mining')}</span
                      ></case
                    >
                    <case value="1">
                      <if condition="$vo.ready neq 0">
                    <button data-toggle="modal" data-target="#claimform_{$vo['id']}" class="btn btn-sm btn-success btn-block">
                        <i class="fa fa-arrow-circle-down"></i> {:l('Claim Reward')}</span>
                     <else/>
                     
                     
                      <!-- Only display timers with time greater than 0 -->
                      <if condition="$vo.wait_time gt 0">
                          <div class="countdown" id="timer-{$vo.id}" data-seconds="{$vo.wait_time}">
                              
                              <div class="countdown-timer"><span class="hours">00</span><label>{:l('Hour')}</label></div>
                              <div class="countdown-timer"><span class="minutes">00</span><label>{:l('Minute')}</label></div>
                              <div class="countdown-timer"><span class="seconds">00</span><label>{:l('Second')}</label></div>
                          </div>
                      </if>
                  

                      </if>
                     
                    </case>
                    <case value="2">--</case>
                  </switch>
                </td>
              </tr>
            
            </volist>
          </tbody>
        </table>
        
      </div>
      <div class="card-footerx"><div class="pages">{$page}</div></div>
      </div>
    </div>

   

    <!-- P2P Content End -->
  </main>

  <div class="row d-none">
    <div class="navbar navbar-default navbar-xs navbar-component">
      <ul class="nav navbar-nav no-border visible-xs-block">
        <li>
          <a
            class="text-center collapsed"
            data-toggle="collapse"
            data-target="#navbar-filter"
            ><i class="icon-circle-down2"></i
          ></a>
        </li>
      </ul>
      <div class="navbar-collapse collapse" id="navbar-filter">
        <p class="navbar-text">{:l('Filter:')}</p>
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a class="text-info" href="{:U('Pool/index')}">Mining </a>
          </li>
          <li class="dropdown active">
            <a class="" href="{:U('Pool/myMachines')}">My Machines </a>
          </li>
          <li class="dropdown">
            <a class="text-info" href="{:U('Pool/myRewards')}">My Rewards </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<volist name="list" id="vo">
  <include file="Pool:claimform" />
</volist>
<script>
  function startpool(id) {
    $.post("{:U('Pool/startMachine')}", { id: id }, function (data) {
      if (data.status == 1) {
        layer.msg(data.info, { icon: 1 });
        window.setTimeout("window.location='{:U('Pool/myMachines')}'", 1000);
      } else {
        layer.msg(data.info, { icon: 2 });
      }
    });
  }
  function claimreward(id, claim,pay) {
    
    var amount = $("input[id='pool_box" + id + "']").val();
    if (id == null || id <= 0) {
      
      return false;
    }
    

    var msg = "Claim "+claim+" payable " + pay + "";

    layer.confirm(
      msg,
      {
        btn: ["Confirm", "Cancel"], //PUSH_BUTTON
      },
      function () {
        $.post("{:U('Pool/claimReward')}", { id: id }, function (data) {
          
            layer.closeAll("loading");
            trans_lock = 0;
            console.log(data);
            if (data.status == 1) {
              layer.msg(data.info, { icon: 1 });
              window.setTimeout("window.location='{:U('Pool/myRewards')}'", 1000);
            } else {
              layer.msg(data.info, { icon: 2 });
            }
          },
          "json"
        );
      }
    );
  }
  function v1_claimreward(id) {
    $.post("{:U('Pool/claimReward')}", { id: id }, function (data) {
      if (data.status == 1) {
        layer.msg(data.info, { icon: 1 });
        window.setTimeout("window.location='{:U('Pool/myRewards')}'", 1000);
      } else {
        layer.msg(data.info, { icon: 2 });
      }
    });
  }
</script>

<style>
  @media only screen and (max-width: 540px) {
    .mobile_hide {
      display: none;
    }
    #my_machines td {
      display: none;
    }
    #my_machines td:first-child,
    #my_machines td:last-child,
    #my_machines th:first-child,
    #my_machines th:last-child {
      display: table-cell;
    }
    #my_machines td,
    #my_machines th {
      display: none;
    }
  }
  .countdown{
    background-color: var(--common-bg-opacity);
    border-radius:var(--theme-border-radius);
    text-align: center;
    
  }
  .countdown-timer {
    display: inline-block;
    color:var(--common-text);
    padding:4px 8px;
 
    text-align: center;
}

.countdown-timer span {
    display: block;
    font-size: 1rem;
}

.countdown-timer label {
    display: block;
    font-size: 0.75rem;
    opacity: 0.75;
}
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      var countdownElements = document.querySelectorAll('.countdown');
  
      countdownElements.forEach(function(countdown) {
          var secondsLeft = parseInt(countdown.getAttribute('data-seconds'), 10);
       //   var daysElement = countdown.querySelector('.days');
          var hoursElement = countdown.querySelector('.hours');
          var minutesElement = countdown.querySelector('.minutes');
          var secondsElement = countdown.querySelector('.seconds');
  
          function updateCountdown() {
              var days = Math.floor(secondsLeft / (24 * 60 * 60));
              var hoursLeft = secondsLeft % (24 * 60 * 60);
              var hours = Math.floor(hoursLeft / (60 * 60));
              var minutesLeft = hoursLeft % (60 * 60);
              var minutes = Math.floor(minutesLeft / 60);
              var seconds = minutesLeft % 60;
  
              //daysElement.textContent = days.toString().padStart(2, '0');
              hoursElement.textContent = hours.toString().padStart(2, '0');
              minutesElement.textContent = minutes.toString().padStart(2, '0');
              secondsElement.textContent = seconds.toString().padStart(2, '0');
  
              if (secondsLeft <= 0) {
                  clearInterval(interval);
                  countdown.innerHTML = 'Time is up!';
              }
              secondsLeft--;
          }
  
          updateCountdown(); // Run immediately to avoid initial delay
          var interval = setInterval(updateCountdown, 1000);
      });
  });
  </script>
  
<script>
  


  function secondsToDhms(seconds) {
    seconds = Number(seconds);
    var d = Math.floor(seconds / (3600 * 24));
    var h = Math.floor((seconds % (3600 * 24)) / 3600);
    var m = Math.floor((seconds % 3600) / 60);
    var s = Math.floor(seconds % 60);
    return [d,h,m,s];
  }
  
</script>
<include file="Public:footer_minimal" />
